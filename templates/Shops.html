<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Shops</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='Shops.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='tabicon.png') }}" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Italianno&family=Lobster&display=swap" rel="stylesheet">
</head>

<body>
<div class="navbar">
    <div class="logo">
        <a href="{{ url_for('home') }}"><img src="{{ url_for('static', filename='logo.png') }}" width="125px" alt="Dunkin' logo"></a>
    </div>
    <nav>
        <ul>
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li><a href="{{ url_for('shops') }}">Shops</a></li>
            <li><a href="{{ url_for('cart') }}">Cart</a></li>
            <li><a href="{{ url_for('contact') }}">Contact Us</a></li>
            {% if session.get('user_id') %}
                {% if session.get('user_type') == 'admin' %}
                    <li><a href="{{ url_for('admin') }}">Admin Dashboard</a></li>
                {% endif %}
                <li><a href="{{ url_for('logout') }}" onclick="return confirm('Are you sure you want to Log-Out?')">Logout</a></li>
                <li style="color:#fff; font-size:22px;">Hello! {{ session.get('name', 'User') }}</li>
            {% else %}
                <li><a href="{{ url_for('login') }}">Login/Register</a></li>
            {% endif %}

        </ul>
    </nav>
</div>
<!-- Shop section -->
<div class="shops">
    <!-- All Shops -->
    <div class="shop-container" id="shopList">
        {% for shop_com in shops %}
            <a href="{{ url_for('shop_products', shop_name=shop_com.name) }}">
                <div class="shop-card">
                    <img src="{{ url_for('static', filename='uploads/' ~ shop_com.shop_img) }}"
                         alt="{{ shop_com.name }}">
                    <h2>{{ shop_com.name }}</h2>
                </div>
            </a>
        {% endfor %}
    </div>

    <!-- Dunkin Products -->
    {% if products %}
        <h1 style="color:black;">{{ shop_name }} Products</h1>

        <div class="shop-container">
            {% for item in products %}
                <div class="product-card">
                    <img src="{{ url_for('static', filename='uploads/' ~ item.product_img) }}" alt="{{ item.name }}">
                    <h2>{{ item.name }}</h2>
                    <p>â‚±{{ item.price }}</p>

                    <form action="{{ url_for('add_to_cart') }}" method="POST" class="cart-form">
                        <input type="hidden" name="product_id" value="{{ item.id }}">
                        <input type="hidden" name="shop_table" value="{{ shop_name }}">

                        <div class="quantity-container">
                            <label for="qty_{{ item.id }}">Qty:</label>
                            <input type="number"
                                   name="quantity"
                                   id="qty_{{ item.id }}"
                                   min="1"
                                   max="10"
                                   value="1">
                        </div>

                        <button type="submit" class="cart-btn">Add to Cart</button>
                    </form>
                </div>

            {% endfor %}
        </div>

        <!-- Back Button -->
        <button id="backBtn" onclick="window.location.href='{{ url_for('shops') }}'">Go Back</button>
    {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const forms = document.querySelectorAll(".cart-form");

    forms.forEach(form => {
        form.addEventListener("submit", function (e) {
            e.preventDefault();

            let formData = new FormData(this);

            fetch("{{ url_for('add_to_cart') }}", {
                method: "POST",
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                showMessage("Added to cart!");
            })
            .catch(() => showMessage("Login First", true));
        });
    });
});

function showMessage(text, error = false) {
    const box = document.createElement("div");
    box.textContent = text;

    box.style.position = "fixed";
    box.style.top = "20px";
    box.style.right = "20px";
    box.style.background = error ? "#ff4d4d" : "#4CAF50";
    box.style.color = "white";
    box.style.padding = "15px 25px";
    box.style.borderRadius = "8px";
    box.style.zIndex = "10000";

    document.body.appendChild(box);

    setTimeout(() => {
        box.style.opacity = "0";
        box.style.transition = "opacity 0.5s";
        setTimeout(() => box.remove(), 500);
    }, 1200);
}
</script>



</body>
</html>
